package de.staticcode.candy.module.modules.EXPLOITS;

import de.staticcode.candy.Candy;
import de.staticcode.candy.math.ServerLaggTime;
import de.staticcode.candy.module.Module;
import de.staticcode.candy.module.category.Category;

public class LaggDetector extends Module {

    public LaggDetector ( ) {
        super ( "LaggDetector" , Category.EXPLOITS );
    }

    private long lastShowed;
    private long laggingSince;

    private boolean showed;

    @Override
    public void onUpdate ( ) {
        if (ServerLaggTime.distLastPacket ( ) > 1000L) {

            if (!this.showed) {
                this.laggingSince = System.currentTimeMillis ( );

                Candy.sendChat ( "We received the last packet since " + ServerLaggTime.distLastPacket ( )
                        + ". I predict that the server is lagging." );
                this.showed = true;
            }

            if (this.sinceLastShowed ( ) > 5000L) {
                Candy.sendChat ( "The server is lagging since " + ( this.sinceLagging ( ) / 20 ) + " seconds." );
            }

            this.lastShowed = System.currentTimeMillis ( );
            return;
        } else {
            this.showed = false;
        }
        super.onUpdate ( );
    }

    private long sinceLagging ( ) {
        return Math.abs ( System.currentTimeMillis ( ) - this.laggingSince );
    }

    private long sinceLastShowed ( ) {
        return Math.abs ( System.currentTimeMillis ( ) - this.lastShowed );
    }

}
